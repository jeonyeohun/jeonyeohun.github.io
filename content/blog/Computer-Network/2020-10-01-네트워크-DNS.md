---
title: '[네트워크] DNS'
date: 2020-10-01 19:05:66
category: Computer-Network
thumbnail: { thumbnailSrc }
draft: false
---

_**참고도서: 컴퓨터 네트워킹 : 하향식 접근. 7판. James F. Kurose , Keith W.Ross 지음**_

## 호스트를 식별하는 방법

- 패킷을 전달하거나 어떤 서버로 접속할 떄, 우리는 해당 호스트가 누구인지 식별할 수 있는 수단이 필요하다.
- 그래서 우리는 www.example.com 과 같은 `호스트 이름(Host Name)`을 사용한다.
- 하지만 호스트 이름은 가변 문자이기 때문에 라우터가 처리하기에는 어려움이 있다. 그래서 4바이트로 구성된 127.0.0.1 과 같은 `IP 주소` 를 컴퓨터 내부에서는 사용한다.
- 사람은 호스트 이름을 선호하지만 라우터는 IP주소를 선호하기 때문에, 호스트 이름을 IP 주소로 변환하는 기술인 `DNS(Domain Name System)` 가 고안되어 사용되고 있다.

## DNS(Domain Name System)

- DNS는 DNS 서버들이 계층 구조로 나뉘어져 구성되는 `분산 데이터베이스` 임과 동시에 호스트에게 이 데이터베이스 정보를 제공하는 `어플리케이션 계층 프로토콜`이기도 하다.
- DNS는 프로토콜은 `UDP` 를 사용하여 수행되고 포트번호는 `53번` 을 사용한다.
- 어떤 사용자가 www.example.com에 접속을 시도한다고 가정해보자. 이떄 DNS 프로토콜은 다음과 같은 과정을 거친다.
  1. 사용자가 입력한 주소(호스트 이름)이 브라우저에서 추출되어서 DNS 의 클라이언트에 전달된다.
  2. DNS 클라이언트는 DNS 서버로 호스트 이름을 보내서 IP주소를 요청한다.
  3. DNS 클라이언트는 IP주소를 받은 뒤 브라우저에게 해당 주소를 전달한다.
  4. 브라우저는 전달받은 IP 주소와 해당 주소의 80번 포트에 HTTP 프로토콜을 이용해 TCP 연결을 수행한다.
- DNS 는 여러 다른 서비스들도 제공한다.
  - `호스트 앨리어싱(Host Aliacing)` : 복잡한 호스트 이름을 가진 호스트가 별명을 통해 단축된 호스트 이름을 가질 수 있게 한다. 여기서 진짜 호스트 이름을 `정식 호스트 이름 (canonical hostname)` 이라고 한다. DNS 는 이렇게 별칭으로 입력된 호스트 이름에 대해서 정식 호스트 이름을 얻을 수 있게 하는 기능을 수행한다.
  - `메일 서버 앨리어싱(Mail Server Aliacing)` : 일반 호스트 이름과 마찬가지로 메일 서버의 호스트 역시 별칭을 통해 더 간단하고 기억하기 쉬운 호스트 이름을 가질 수 있도록 한다.
  - `부하 분산(Load Distribution)` : 중복 서버 사이에 걸리는 부하를 분산시키기 위해 사용된다. 여러 IP주소가 하나의 정식 호스트 이름과 연결된 경우에, 한번에 많은 연결이 요청되더라도 DNS는 순환식으로 응답을 보내기 때문에 트래픽 부하가 분산되는 효과가 있다.

## DNS 동작원리

### 분산 계층 데이터베이스

- DNS 서버는 확정성을 위해 DNS 서버를 여러 계층으로 나누어서 서버를 분산한다. DNS 서버는 총 세 유형의 계층 서버들로 구성되는데, `루트 DNS 서버`, `최상위 레벨 도메인 네임 DNS 서버(TLD)`, 그리고 `책임 DNS 서버`로 이루어져 있다.
- `루트 DNS 서버` : 클라이언트가 호스트 이름을 입력하고 접속을 시도할 때, 우선적으로 호스트 이름이 루트 DNS 서버로 전달된다. 루트 DNS 서버는 전 세계에 400개 이상이 존재하고 13개의 기관에서 나누어서 관리하고 있다. 루트 DNS서버는 전달된 호스트 이름을 확인하고 그에 맞는 TLD 서버의 IP를 다시 전달한다.
- `최상위 레벨 도메인(TLD) 서버` : `.com`, `.org`, `.net` 과 같은 상위 레벨 도메인이 각각 TLD 서버에서 관리된다. TLD 서버로 전달된 호스트 이름은 이름에 맞는 책임 DNS 서버의 IP 주소가 되어 전달된다.
- `책임 DNS 서버` : 책임 DNS 서버는 각 호스트 이름에 대한 IP 주소를 맵핑해서 가지고 있다.
- DNS는 위 서버를 요청 호스트와 직접적으로 통신하는 것으로 동작하지 않고 요청 호스트와 DNS 계층 서버 사이에 `로컬 DNS 서버` 를 두어 요청과 응답을 주고받는다.

### 동작 과정

- 실제로 어떤 호스트 이름을 사용자가 입력하면 분산 계층에 따라 다음과 같은 과정으로 진행된다.
  1. 요청 호스트가 `로컬 DNS 서버`에 호스트 이름을 보낸다.
  2. 로컬 DNS 서버는 `루트 DNS 서버`에 요청메세지를 전달한다. 루트 DNS 서버는 전달된 호스트 이름에 대한 책임을 가진 TLD 서버의 IP 주소리스트를 로컬 DNS 서버로 보낸다.
  3. 로컬 DNS 서버는 응답받은 `TLD 서버`로 DNS 요청 메세지를 다시 보낸다. TLD 서버는 전달받은 호스트 이름에 대한 책임을 가진 책임 DNS 서버의 IP 주소를 로컬 DNS 서버로 보낸다.
  4. 로컬 DNS 서버는 응답반은 `책임 DNS 서버`로 DNS 요청 메세지를 보낸다. 이제 책임 DNS 서버는 전달받은 호스트 이름에 대한 모든 맵핑결과를 로컬 DNS 서버로 전달한다.
  5. 로컬 DNS 서버는 응답받은 결과를 요청 호스트에게 응답메세지로 보낸다.
- DNS 가 동작하는 과정은 `재귀적 질의(recursive query)` 와 `반복적 질의(iterative query)` 로 나뉘는데, 위처럼 각 계층 서버들이 로컬 DNS 서버와 질의/응답을 주고받으며 IP 주소를 받아오는 과정을 반복적 질의라 하고, 재귀적 질의는 각 계층 서버가 로컬 DNS 서버를 거치지 않고 직접적으로 자신의 하위 계층 서버에게 요청을 보내 응답을 받는 구조를 의미한다. 즉, 재귀적 질의에서는 `요청 호스트->로컬 DNS 서버->루트 DNS 서버->TLD DNS 서버->책임 DNS 서버` 순으로 요청메세지를 보내게 된다.

### DNS 캐싱

- 웹캐싱과 같은 개념으로 DNS도 이전에 가져왔던 IP 주소에 대한 정보를 미리 저장해둠으로 DNS 캐싱을 구현할 수 있다.
- 로컬 DNS 서버가 IP 주소를 미리 보관해두고 요청 호스트에서 자신이 가지고 있는 호스트에 대한 IP 주소정보를 요청했을 때, DNS 계층 서버들을 방문할 필요없이 바로 IP주소를 제공할 수 있게 한다.

## DNS 레코드

- 각 계층의 DNS서버는 `자원 레코드(Resource Record, RR)`를 통해 호스트 이름과 IP주소를 맵핑한다.
- 자원 레코드는 `Name`, `Value`, `Type`, `TTL`의 네 개의 투플로 이루어져 있다.
- 여기서 `Type` 필드에 어떤 값이 들어가는지에 따라 `Name` 과 `Value` 의 값을 해석하는 방법이 달라진다.
  - `Type=A`의 경우에는 `Name 은 호스트 이름`, `Value는 해당 호스트에 대한 IP 주소`를 의미한다. (i.e. `(relay1.bar.foo.com, 145.37.42.126, A)`)
  - `Type=NS`의 경우에는 `Name은 도메인 이름`, `Value는 도메인 내부의 호스트에 대한 책임 DNS 서버의 호스트 이름` 을 의미한다. (i.e. `(foo.com, dns.foo.com, NS)`)
  - `Tyee=CNMAE`의 경우에는 `Name은 별칭 호스트 이름`, `Value는 정식 호스트 이름` 을 의미한다. (i.e. `(foo.com, relay.bar.foo.com, CNAME)`)
  - `Tyee=MX`의 경우에는 `Name은 메일 서버의 별칭 호스트 이름`, `Value는 정식 호스트 이름` 을 의미한다. (i.e. `(foo.com, mail.foo.com, MX)`)

## DNS 메세지

- DNS 의 질의와 응답(query and response)에 사용되는 DNS 메세지는 아래와 같은 필드들로 구성되어 있다.

1. `헤더 영역` : 첫 12바이트를 차지하고 여러 개의 하위 필드를 포함한다.

   - `식별자` : 이 식별자를 통해 질의에 대한 수신과 응답을 맵핑시킨다.
   - `질의/응답 플래그` : 이 메세지가 `질의라면 0, 응답이라면 1`을 설정한다.
   - `책임 플래그` : DNS 서버가 질의 이름에 대한 책임 서버일 때 설정한다.
   - `재귀 요구 플래그` : DNS 서버가 레코드를 가지고 있지 않을 때 호스트 혹은 DNS 서버가 재귀적인 질의를 원한다면 설정된다.
   - `재귀 가능 필드` : DNS 서버가 재귀적 질의를 허용한다면 설정된다.
   - `개수 필드` : 질의의 수, 답변의 RR 수, 책임 RR의 수, 추가 RR의 수를 저장한다.

2. `질문 영역` : 현재 질의에 대한 정보를 담는다. 질의되는 이름과 질문의 타입이 저장된다.

3. `답변 영역` : 질의에 대한 자원 레코드(RR) 가 포함된다. 호스트 이름은 여러개의 IP 주소를 가질 수 있기 때문에 RR 역시 여러개가 응답될 수 있다.

4. `책임 영역` : 다른 책임 서버의 RR을 포함한다.

5. `추가 영역` : 추가적으로 도움이 될만한 RR을 포함한다. 예를들어, DNS 서버가 가진 호스트 이름이 별칭 호스트 이름이라면 TYPE-A 레코드를 가지고 있어 별칭 호스트에 대한 정식 이름과 IP 주소 정보를 포함하게 된다.

## DNS 데이터베이스

- DNS 가 분산형 데이터베이스라면, 어딘가에서 이 데이터베이스에 정보들을 넣어줘야 인터넷 사용자들이 데이터를 사용할 수 있을 것이다.
- 도메인 이름은 특정한 등록기관들이 관리하게 되는데, 이런 관리 기관들 때문에 도메인이 중복되지 않고 유일성을 유지할 수 있다.
- 이런 등록기관은 `ICANN(InternetCorporation for Assigned Names and Numbers)`에서 승인한다.
